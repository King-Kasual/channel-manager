# channel-manager â€” Make targets

Simple reference for Make targets. Run from the repository root.

Prerequisites

- Python venv active (optional) or Docker installed
- `requirements.txt` installed if using local commands
- `docker-compose` available for container targets

Make targets

- `make install`  
  Install Python dependencies: `pip3 install -r requirements.txt`.

- `make install-deps`  
  Alias for `make install`.

- `make format`  
  Run code formatter: `python3 -m black .`

- `make format-check`  
  Verify formatting without modifying files: `python3 -m black --check .`

- `make lint`  
  Run static analysis with Pylint (skips Alembic migrations): `python3 -m pylint $(git ls-files '*.py' ':(exclude)alembic/**')`

- `make check`  
  Run both format and lint checks: executes `make format-check` and `make lint`

- `make build`  
  Build the app image: `docker compose build app`

- `make run`  
  Recreate and run the app service (build first): `docker compose down app && docker compose up app -d --build`

- `make run-all`  
  Bring up the full stack in background: `docker compose up -d`

- `make psql-run`  
  Start only Postgres service: `docker compose up postgres`

- `make stop`  
  Stop and remove containers: `docker compose down`

- `make clean`  
  Prune unused Docker images: `docker image prune -a`

Migration helpers (Alembic)

- `make revision REVID=<id> MSG="message"`  
  Create an autogenerate revision. Both `REVID` (e.g. `0002`) and `MSG` are required by the current Makefile:
  Example: `make revision REVID=0002 MSG="add description column"`

- `make upgrade`  
  Apply all migrations: `alembic upgrade head`

- `make downgrade REV=<rev>`  
  Revert to a specific revision: `alembic downgrade <rev>`

- `make current`  
  Show current DB revision: `alembic current`

- `make history`  
  Show migration history: `alembic history --verbose`

- `make run-migrations`  
  Run migrations via the repository runner: `python3 scripts/run_migrations.py`

- `make docker-migrate`  
  Run migrations inside the app container: `docker compose run --rm app python scripts/run_migrations.py`

Examples

- Create a new numeric revision and autogenerate SQL:
  `make revision REVID=0003 MSG="create new table"`
- Apply migrations locally:
  `make upgrade`
- Apply migrations inside Docker:
  `make docker-migrate`
- Build and run full stack:
  `make run-all`

Notes

- Always inspect autogenerated migration files in `alembic/versions/` before applying.
- Run Make commands from the repo root so Alembic and imports resolve correctly.
